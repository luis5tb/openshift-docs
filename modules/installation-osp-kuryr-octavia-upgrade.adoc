// Module included in the following assemblies:
//
// * networking/openstack/load-balancing-openstack.adoc

[id="installation-osp-kuryr-octavia-configure{context}"]
= Configuring a cluster to use the {rh-openstack} Octavia provider driver

If your {product-title} cluster uses Kuryr and was installed on a {rh-openstack-first} 13 cloud
that was later upgraded to {rh-openstack} 16, you can configure it to use the Octavia OVN provider driver.

[IMPORTANT]
====
Kuryr replaces existing load balancers after you change provider drivers. This process
results in some downtime.
====

.Prerequisites

* Install the {rh-openstack} CLI, `openstack`.

* Install the {product-title} CLI, `oc`.

* Verify that the Octavia OVN driver on {rh-openstack} is enabled.
+
[TIP]
====
To view a list of available Octavia drivers, on a command line, enter `openstack loadbalancer provider list`.
You should see the `ovn` driver in the command's output.
====

.Procedure

To change from the Octavia Amphora provider driver to Octavia OVN:

. Open the `kuryr-config` ConfigMap. On a command line, enter:
+
----
$ oc -n openshift-kuryr edit cm kuryr-config
----

. In the ConfigMap, delete the line that contains `kuryr-octavia-provider: default`. For example:
+
----
...
kind: ConfigMap
metadata:
  annotations:
    networkoperator.openshift.io/kuryr-octavia-provider: default <1>
...
----
<1> Delete this line. The cluster will regenerate it with `ovn` as the value.
+
Wait for the Cluster Network Operator detects the modification and redeploys the `kuryr-controller` and `kuryr-cni` pods. This process may take several minutes.

. Verify that the `kuryr-config` ConfigMap annotation is present with `ovn` as its value. On a command line, enter:
+
----
$ oc -n openshift-kuryr edit cm kuryr-config
----
+
The `ovn` provider value should be present in the output:
+
----
...
kind: ConfigMap
metadata:
  annotations:
    networkoperator.openshift.io/kuryr-octavia-provider: ovn
...
----

. Verify that {rh-openstack} recreated its load balancers.

.. On a command line, type:
+
----
$ openstack loadbalancer list | grep amphora
----
+
You should see a single Amphora load balancer. For example:
+
----
a4db683b-2b7b-4988-a582-c39daaad7981 | ostest-7mbj6-kuryr-api-loadbalancer  | 84c99c906edd475ba19478a9a6690efd | 172.30.0.1     | ACTIVE              | amphora
----

.. Then, type:
+
----
$ openstack loadbalancer list | grep ovn
----
+
The remaining load balancers should be the `ovn` type. For example:
+
----
2dffe783-98ae-4048-98d0-32aa684664cc | openshift-apiserver-operator/metrics | 84c99c906edd475ba19478a9a6690efd | 172.30.167.119 | ACTIVE              | ovn
0b1b2193-251f-4243-af39-2f99b29d18c5 | openshift-etcd/etcd                  | 84c99c906edd475ba19478a9a6690efd | 172.30.143.226 | ACTIVE              | ovn
f05b07fc-01b7-4673-bd4d-adaa4391458e | openshift-dns-operator/metrics       | 84c99c906edd475ba19478a9a6690efd | 172.30.152.27  | ACTIVE              | ovn
----
